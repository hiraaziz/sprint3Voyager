"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const axios = require('axios');
const https = require('https');
const constant = require("./constant.json");
const cloudwatch_1 = require("./cloudwatch");
const { S3Bucket } = require('./s3');
exports.webhandler = async function (event, context) {
    let values;
    // Download file from s3 bucket
    const s3Bucket = new S3Bucket();
    let constants = await s3Bucket.downloadfrom_s3t(env.bucket_name, "constant.json");
    // Iterate each URL
    for (var urls of constant.url) {
        var avail = await get_availability(urls);
        var latency = await get_latency(urls);
        //publishing metric of availability and latency
        let cw_avail = cloudwatch_1.publish_metric(constant.url_namespace, constant.Metricname_avail, urls, avail);
        let cw_latency = cloudwatch_1.publish_metric(constant.url_namespace, constant.Metricname_latency, urls, latency);
        values = {
            "url": urls,
            "availability": avail,
            "latency": latency
        };
        console.log(values);
    }
    return values;
};
// Get Availability
async function get_availability(url) {
    const res = await axios.get(url);
    if (res.status == 200 || res.status == 201) { // If status will return 200 & 201, website is available
        return 1;
    }
    else {
        return 0;
    }
}
// Get Latency
async function get_latency(url) {
    const strt_time = new Date().getTime();
    const res = await axios.get(url);
    const end_time = new Date().getTime();
    const diff = end_time - strt_time;
    const latency = diff / 1000; // Calculating difference between start & end time
    console.log(latency);
    return latency;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViSGVhbHRoTGFtYmRhLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsid2ViSGVhbHRoTGFtYmRhLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQy9CLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUMvQixNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUM1Qyw2Q0FBNEM7QUFDNUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQTtBQUVwQyxPQUFPLENBQUMsVUFBVSxHQUFHLEtBQUssV0FBVSxLQUFTLEVBQUMsT0FBVztJQUNyRCxJQUFJLE1BQVUsQ0FBQztJQUVYLCtCQUErQjtJQUMvQixNQUFNLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFBO0lBQy9CLElBQUksU0FBUyxHQUFHLE1BQU0sUUFBUSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsZUFBZSxDQUFDLENBQUE7SUFFakYsbUJBQW1CO0lBQ25CLEtBQUksSUFBSSxJQUFJLElBQUksUUFBUSxDQUFDLEdBQUcsRUFBRTtRQUUzQixJQUFJLEtBQUssR0FBRyxNQUFNLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pDLElBQUksT0FBTyxHQUFHLE1BQU0sV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXRDLCtDQUErQztRQUMvQyxJQUFJLFFBQVEsR0FBQywyQkFBYyxDQUFDLFFBQVEsQ0FBQyxhQUFhLEVBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFDLElBQUksRUFBQyxLQUFLLENBQUMsQ0FBQTtRQUN4RixJQUFJLFVBQVUsR0FBQywyQkFBYyxDQUFDLFFBQVEsQ0FBQyxhQUFhLEVBQUMsUUFBUSxDQUFDLGtCQUFrQixFQUFDLElBQUksRUFBQyxPQUFPLENBQUMsQ0FBQTtRQUV6RixNQUFNLEdBQUM7WUFDUCxLQUFLLEVBQUMsSUFBSTtZQUNWLGNBQWMsRUFBQyxLQUFLO1lBQ3BCLFNBQVMsRUFBQyxPQUFPO1NBQUMsQ0FBQztRQUUzQixPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQ2pCO0lBRUQsT0FBTyxNQUFNLENBQUE7QUFDckIsQ0FBQyxDQUFDO0FBRUosbUJBQW1CO0FBQ25CLEtBQUssVUFBVSxnQkFBZ0IsQ0FBQyxHQUFVO0lBRXRDLE1BQU0sR0FBRyxHQUFHLE1BQU0sS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNqQyxJQUFJLEdBQUcsQ0FBQyxNQUFNLElBQUUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxNQUFNLElBQUUsR0FBRyxFQUFDLEVBQUUsd0RBQXdEO1FBQzdGLE9BQU8sQ0FBQyxDQUFBO0tBQ1g7U0FDRztRQUNBLE9BQU8sQ0FBQyxDQUFBO0tBQ1g7QUFDTCxDQUFDO0FBRUQsY0FBYztBQUNkLEtBQUssVUFBVSxXQUFXLENBQUMsR0FBVTtJQUNqQyxNQUFNLFNBQVMsR0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ3JDLE1BQU0sR0FBRyxHQUFHLE1BQU0sS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNqQyxNQUFNLFFBQVEsR0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ3BDLE1BQU0sSUFBSSxHQUFHLFFBQVEsR0FBQyxTQUFTLENBQUE7SUFDL0IsTUFBTSxPQUFPLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLGtEQUFrRDtJQUMvRSxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ3BCLE9BQU8sT0FBTyxDQUFBO0FBQ2xCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJyk7XHJcbmNvbnN0IGh0dHBzID0gcmVxdWlyZSgnaHR0cHMnKTtcclxuY29uc3QgY29uc3RhbnQgPSByZXF1aXJlKFwiLi9jb25zdGFudC5qc29uXCIpO1xyXG5pbXBvcnQge3B1Ymxpc2hfbWV0cmljfSBmcm9tICcuL2Nsb3Vkd2F0Y2gnO1xyXG5jb25zdCB7IFMzQnVja2V0IH0gPSByZXF1aXJlKCcuL3MzJykgXHJcblxyXG5leHBvcnRzLndlYmhhbmRsZXIgPSBhc3luYyBmdW5jdGlvbihldmVudDphbnksY29udGV4dDphbnkpIHtcclxuICAgIGxldCB2YWx1ZXM6YW55O1xyXG5cclxuICAgICAgICAvLyBEb3dubG9hZCBmaWxlIGZyb20gczMgYnVja2V0XHJcbiAgICAgICAgY29uc3QgczNCdWNrZXQgPSBuZXcgUzNCdWNrZXQoKVxyXG4gICAgICAgIGxldCBjb25zdGFudHMgPSBhd2FpdCBzM0J1Y2tldC5kb3dubG9hZGZyb21fczN0KGVudi5idWNrZXRfbmFtZSwgXCJjb25zdGFudC5qc29uXCIpXHJcblxyXG4gICAgICAgIC8vIEl0ZXJhdGUgZWFjaCBVUkxcclxuICAgICAgICBmb3IodmFyIHVybHMgb2YgY29uc3RhbnQudXJsKSB7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgICB2YXIgYXZhaWwgPSBhd2FpdCBnZXRfYXZhaWxhYmlsaXR5KHVybHMpO1xyXG4gICAgICAgICAgIHZhciBsYXRlbmN5ID0gYXdhaXQgZ2V0X2xhdGVuY3kodXJscyk7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgLy9wdWJsaXNoaW5nIG1ldHJpYyBvZiBhdmFpbGFiaWxpdHkgYW5kIGxhdGVuY3lcclxuICAgICAgICAgICBsZXQgY3dfYXZhaWw9cHVibGlzaF9tZXRyaWMoY29uc3RhbnQudXJsX25hbWVzcGFjZSxjb25zdGFudC5NZXRyaWNuYW1lX2F2YWlsLHVybHMsYXZhaWwpXHJcbiAgICAgICAgICAgbGV0IGN3X2xhdGVuY3k9cHVibGlzaF9tZXRyaWMoY29uc3RhbnQudXJsX25hbWVzcGFjZSxjb25zdGFudC5NZXRyaWNuYW1lX2xhdGVuY3ksdXJscyxsYXRlbmN5KVxyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdmFsdWVzPXtcclxuICAgICAgICAgICAgICAgIFwidXJsXCI6dXJscyxcclxuICAgICAgICAgICAgICAgIFwiYXZhaWxhYmlsaXR5XCI6YXZhaWwsXHJcbiAgICAgICAgICAgICAgICBcImxhdGVuY3lcIjpsYXRlbmN5fTtcclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgY29uc29sZS5sb2codmFsdWVzKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICByZXR1cm4gdmFsdWVzXHJcbiAgfTtcclxuXHJcbi8vIEdldCBBdmFpbGFiaWxpdHlcclxuYXN5bmMgZnVuY3Rpb24gZ2V0X2F2YWlsYWJpbGl0eSh1cmw6c3RyaW5nKXtcclxuXHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCBheGlvcy5nZXQodXJsKTtcclxuICAgIGlmIChyZXMuc3RhdHVzPT0yMDAgfHwgcmVzLnN0YXR1cz09MjAxKXsgLy8gSWYgc3RhdHVzIHdpbGwgcmV0dXJuIDIwMCAmIDIwMSwgd2Vic2l0ZSBpcyBhdmFpbGFibGVcclxuICAgICAgICByZXR1cm4gMVxyXG4gICAgfVxyXG4gICAgZWxzZXtcclxuICAgICAgICByZXR1cm4gMFxyXG4gICAgfVxyXG59XHJcblxyXG4vLyBHZXQgTGF0ZW5jeVxyXG5hc3luYyBmdW5jdGlvbiBnZXRfbGF0ZW5jeSh1cmw6c3RyaW5nKXtcclxuICAgIGNvbnN0IHN0cnRfdGltZT1uZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGF4aW9zLmdldCh1cmwpO1xyXG4gICAgY29uc3QgZW5kX3RpbWU9bmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICBjb25zdCBkaWZmID0gZW5kX3RpbWUtc3RydF90aW1lXHJcbiAgICBjb25zdCBsYXRlbmN5ID0gZGlmZiAvIDEwMDA7IC8vIENhbGN1bGF0aW5nIGRpZmZlcmVuY2UgYmV0d2VlbiBzdGFydCAmIGVuZCB0aW1lXHJcbiAgICBjb25zb2xlLmxvZyhsYXRlbmN5KVxyXG4gICAgcmV0dXJuIGxhdGVuY3lcclxufSJdfQ==